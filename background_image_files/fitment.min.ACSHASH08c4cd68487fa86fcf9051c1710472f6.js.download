"use strict";(self.webpackChunkaem_maven_archetype=self.webpackChunkaem_maven_archetype||[]).push([[4448],{30365:function(e,t,i){var s=i(86316),d=i.n(s),o=i(57318),a=i.n(o),n=i(86436),l=i(94774),r=i(18880),h=i(16325);const c=()=>{};class m{constructor(e){const t=document.querySelector("html");let i=!1;t&&(i="true"===t.getAttribute("data-gigya-auto-login")),this.isGigyaToggle=i,this.$el=$(e),this.isMixedPlp=!1,this.render(),this.props(),this.initListener(),this.initGigyaHandlers(),this.isLoggedIn=!1,this.isSearch&&!this.isPartsUrl&&this.hide()}initListener(){r.Z.addListener(r.Z.PROPAGATE_SEARCH_DATA,((e,t,i,s,d,o)=>{if(this.$el.parents(".cmp-search-fitment").data("enable-fitment-mixed-page")){let t=e?.facets;for(let e=0;e<t?.length;e++)if(t[e].name&&t[e].name.includes("primaryCategoryCode")&&!window.location.search.includes("q1=parts")){let i=t[e].values;for(let e=0;e<i.length;e++)if("parts"==i[e].value){this.isMixedPlp=!0;break}}}this.isPartsUrl&&("parts"===t||this.isPartsUrl?(this.render(),this.props(),this.isGigyaToggle&&this.isLoggedIn||!this.isGigyaToggle&&n.Z.isLoggedIn()?this.initHandlers(null,!0):this.initHandlers()):this.hide())})),r.Z.addListener(r.Z.FITMENT_SET_HEADER,(()=>{if(this.isPartsUrl)if(this.isSeoEnabled){let e=(0,h.Tt)(window.location.search,!0);const{familyName:t,modelYear:i,modelCode:s,name:d,vanityName:o,type:a}=l.Z.getFitmentCookie(),n=(0,h.uS)(i,t,d,s);this.goToUrl(this.seoCategoryUrl+"/"+n+e)}else(0,h.Rm)(window.location.search,!1,!0),r.Z.emit(r.Z.REFRESH_SEARCH_RESULTS,"fitment");this.refresh()})),r.Z.addListener(r.Z.FITMENT_UNSET_HEADER,(()=>{if(this.isPartsUrl())if(this.isSeoEnabled){let e=(0,h.Tt)(window.location.search,!0),t=this.seoCategoryUrl.endsWith("/shop/c/motorcycle-parts")?"/listing":"";this.goToUrl(this.seoCategoryUrl+t+e)}else(0,h.Rm)(window.location.search,!1,!0),r.Z.emit(r.Z.REFRESH_SEARCH_RESULTS,"fitment")})),r.Z.addListener(r.Z.SHOW_SEARCH_FITMENT,(()=>{this.isPartsUrl&&this.refresh()})),r.Z.addListener(r.Z.HIDE_SEARCH_FITMENT,(()=>{this.hide()}))}initGigyaHandlers(){r.Z.addListener(r.Z.GIGYA_ONSIGNIN,(e=>{this.gigyaSignin(e)})),r.Z.addListener(r.Z.GIGYA_ONSIGNOUT,(e=>{this.gigyaSignout(e)})),this.isGigyaToggle&&(this.$el.find(".save-bike-to-profile").addClass("d-none"),this.$el.find(".non-log-in-user-view").addClass("d-none").removeClass("active-view"),this.$el.find(".logged-in-user-view").addClass("d-none").removeClass("active-view"),r.Z.addListener(r.Z.GIGYA_ONSIGNIN_ACCOUNTINFO,(e=>{e.isLoggedInd&&!this.isLoggedIn&&(this.isLoggedIn=!0,setTimeout((()=>{this.initHandlers(null,!0)}),1e3))})))}props(){this.$savedBikesDropdown=this.$el.find("select.saved-bikes-dropdown"),this.$modelViewToggle=this.$el.find(".model-view-toggle"),this.$loginLink=this.$el.find(".login-link"),this.uidSelected="",this.familyNameSelected="",this.modelYearSelected="",this.modelCodeSelected="",this.nameSelected="",this.vanityNameSelected="",this.typeSelected="",this.savedBikes=null,this.autoSwitch=!1,this.seoCategoryUrl=this.$el.data("seo-category-url")}get isSeoEnabled(){const e=this.$el.parents(".cmp-search-fitment");return!e.length||1==e.data("is-seo-enabled")}get isPartsInitially(){if(this.isPartsUrl)return!0;const e=this.$el.parents(".cmp-search-fitment");return!!e&&"true"==e.data("is-parts-page")}get isSearch(){return!!this.$el.parents(".cmp-search-fitment").length}get isPartsUrl(){return window.location.search.includes("q1=parts")||this.isMixedPlp}refresh(){this.render(),this.isSearch&&!this.isPartsUrl&&this.hide(),this.props(),setTimeout((()=>{this.initHandlers(this.isGigyaToggle?this.isLoggedIn:null)}),500)}refreshDropdowns(){this.$el.find(".fitment-select").selectpicker("refresh")}defaultYearModelValue(){const e=l.Z.getFitmentCookie();if(e){const{uid:t,familyName:i,modelYear:s,modelCode:d,name:o,vanityName:a,type:n}=e;this.uidSelected=t,this.familyNameSelected=i,this.modelYearSelected=s,this.modelCodeSelected=d,this.nameSelected=o,this.vanityNameSelected=a,this.typeSelected=n,this.$savedBikesDropdown.selectpicker("deselectAll"),"model-year"===n?(this.autoSwitch=!0,this.$yearDropdown.val(this.modelYearSelected).change(),this.$el.find(".by-model-filter").removeClass("d-none"),this.$el.find(".by-saved-filter").addClass("d-none"),this.$el.find(".by-model").addClass("d-none"),this.savedBikes?(this.$el.find(".by-saved").removeClass("d-none"),this.$el.find(".save-bike-to-profile").addClass("d-none")):(this.$el.find(".by-saved").addClass("d-none"),this.$el.find(".save-bike-to-profile").removeClass("d-none")),this.$clearSelection.removeClass("d-none").removeClass("saved-active").addClass("my-active")):(this.$savedBikesDropdown.val(this.uidSelected),this.$savedBikesDropdown.selectpicker("render"),this.$el.find(".by-model-filter").addClass("d-none"),this.$el.find(".by-saved-filter").removeClass("d-none"),this.$el.find(".by-model").removeClass("d-none"),this.$el.find(".by-saved").addClass("d-none"),this.$el.find(".save-bike-to-profile").addClass("d-none"),this.$clearSelection.removeClass("d-none").removeClass("my-active").addClass("saved-active"))}this.refreshDropdowns(),this.$el.find(".loading-view").addClass("d-none")}async bindYearDropdownChange(e){const t=this.$yearDropdown.find("option:selected").data("value");if(!t)return;this.$modelDropdown.empty();const i=this.$el.find(".model-dropdown-container").data("select-model");this.$modelDropdown.append('<option value="">'+i+"</option>"),this.$modelDropdown.prop("disabled",!0),this.refreshDropdowns(),this.modelYearSelected=t;let s=await l.Z.getFitment({year:this.modelYearSelected});if(s.data.vehicles)for(let e of s.data.vehicles){let t="";this.modelYearSelected.toString()===e.modelYear.toString()&&(this.autoSwitch&&this.modelCodeSelected===e.modelCode&&(t="selected"),this.$modelDropdown.append(`<option value="${e.uid}" data-uid="${e.uid}" data-family-name="${e.familyName}" data-model-year="${e.modelYear}" data-model-code="${e.modelCode}" data-type="element" data-name="item" ${t}>${e.name}</option>`))}this.$modelDropdown.prop("disabled",!1),this.refreshDropdowns(),this.autoSwitch=!1}async bindModelDropdownChange(e){const t=this.$modelDropdown.find("option:selected");if(!t.data("model-code"))return;this.$clearSelection.removeClass("d-none").removeClass("saved-active").addClass("my-active"),this.uidSelected=t.data("uid"),this.familyNameSelected=t.data("family-name"),this.modelYearSelected=t.data("model-year"),this.modelCodeSelected=t.data("model-code"),this.nameSelected=t.text(),this.vanityNameSelected=t.text(),this.typeSelected="model-year",l.Z.setFitmentCookie(this.uidSelected,this.familyNameSelected,this.modelYearSelected,this.modelCodeSelected,this.nameSelected,this.vanityNameSelected,this.typeSelected);const i=(0,h.uS)(this.modelYearSelected,this.familyNameSelected,this.nameSelected,this.modelCodeSelected);if(this.isSeoEnabled&&!this.isMixedPlp)return this.goToUrl(this.seoCategoryUrl+"/"+i);this.isMixedPlp?(0,h.Rm)(window.location.search+";x30=isMixedPlp;q30=true",!1,!0):(0,h.Rm)(window.location.search,!1,!0),r.Z.emit(r.Z.REFRESH_SEARCH_RESULTS,"fitment"),r.Z.emit(r.Z.FITMENT_SET_PAGE),console.log("FITMENT_SET_PAGE from search-fitment")}async bindSavedBikesDropdownChange(e){const t=this.$savedBikesDropdown.find("option:selected");if(!t.data("uid"))return;this.$clearSelection.removeClass("d-none").removeClass("my-active").addClass("saved-active");let i=await l.Z.getBikeByYearCode(t.data("model-year"),t.data("model-code"));if(this.uidSelected=t.data("uid"),this.familyNameSelected=i.familyName,this.modelYearSelected=t.data("model-year"),this.modelCodeSelected=t.data("model-code"),this.nameSelected=i.name,this.vanityNameSelected=t.text(),this.typeSelected="saved",l.Z.setFitmentCookie(this.uidSelected,this.familyNameSelected,this.modelYearSelected,this.modelCodeSelected,this.nameSelected,this.vanityNameSelected,this.typeSelected),this.isSeoEnabled){const e=(0,h.uS)(this.modelYearSelected,this.familyNameSelected,this.nameSelected,this.modelCodeSelected);return this.goToUrl(this.seoCategoryUrl+"/"+e)}this.$yearDropdown[0].selectedIndex=0,this.$modelDropdown[0].selectedIndex=0,this.$modelDropdown.prop("disabled",!0),this.refreshDropdowns(),(0,h.Rm)(window.location.search,!1,!0),r.Z.emit(r.Z.REFRESH_SEARCH_RESULTS,"fitment"),r.Z.emit(r.Z.FITMENT_SET_PAGE)}bindLoginLink(){this.$loginLink.on("click",(e=>{e.preventDefault(),r.Z.emit(r.Z.GIGYA_SIGNIN)}))}bindClearChanges(){this.$clearSelection.on("click",(e=>{if(e.preventDefault(),l.Z.removeFitmentCookie(),this.resetDropdowns(),this.isSeoEnabled){let e=(0,h.Tt)(window.location.search,!0),t=this.seoCategoryUrl.endsWith("/shop/c/motorcycle-parts")?"/listing":"";this.goToUrl(this.seoCategoryUrl+t+e)}else(0,h.Rm)(window.location.search,!1,!0),r.Z.emit(r.Z.REFRESH_SEARCH_RESULTS,"fitment"),r.Z.emit(r.Z.FITMENT_UNSET_PAGE)}))}bindToggleModelView(){this.$modelViewToggle.off("click").on("click",(e=>{e.preventDefault(),this.$el.find(".by-model-filter").toggleClass("d-none"),this.$el.find(".by-saved-filter").toggleClass("d-none"),this.$el.find(".by-model").toggleClass("d-none"),this.savedBikes?this.$el.find(".by-saved").toggleClass("d-none"):this.$el.find(".save-bike-to-profile").toggleClass("d-none"),this.$el.find(".by-saved-filter").hasClass("d-none")?this.$clearSelection.hasClass("my-active")?this.$clearSelection.removeClass("d-none"):this.$clearSelection.addClass("d-none"):this.$clearSelection.hasClass("saved-active")?this.$clearSelection.removeClass("d-none"):this.$clearSelection.addClass("d-none")}))}resetDropdowns(){this.$yearDropdown[0].selectedIndex=0,this.$modelDropdown[0].selectedIndex=0,this.$modelDropdown.prop("disabled",!0),this.$savedBikesDropdown[0].selectedIndex=0,this.refreshDropdowns(),this.$clearSelection.addClass("d-none").removeClass("saved-active my-active")}gigyaSignin(e){this.initHandlers(e)}gigyaSignout(e){"initial"===e.loadState?this.initHandlers(e):this.refresh()}async initHandlers(e,t){const i=a().get("H-D_PORTAL_SESSION_TYPE");this.isGigyaToggle?t?await this.createLoggedInView():this.createNonLoggedInView(i):n.Z.isLoggedIn()||e&&e?.user&&e?.user.UID?await this.createLoggedInView():this.createNonLoggedInView(i),this.$yearDropdown=this.$el.find(".active-view").find("select.year-dropdown"),this.$modelDropdown=this.$el.find(".active-view").find("select.model-dropdown"),this.$clearSelection=this.$el.find(".active-view").find(".clear-selection"),this.$el.find(".fitment-select").selectpicker(),this.$el.find("select.year-dropdown").on("show.bs.select",((e,t)=>{let i=t.currentTarget;$(i).find(".dropdown-menu").first().find("ul").addClass("show")})),this.$el.find("select.model-dropdown").on("show.bs.select",((e,t)=>{let i=t.currentTarget;$(i).find(".dropdown-menu").first().find("ul").addClass("show")})),this.$el.find("select.saved-bikes-dropdown").on("show.bs.select",((e,t)=>{let i=t.currentTarget;$(i).find(".dropdown-menu").first().find("ul").addClass("show")})),(0,h.gQ)(this.$el,".fitment-select"),this.$yearDropdown.off("change").on("change",(e=>{this.bindYearDropdownChange(e)})),this.$modelDropdown.off("change").on("change",(e=>{this.bindModelDropdownChange(e)})),this.$savedBikesDropdown.off("change").on("change",(e=>{this.bindSavedBikesDropdownChange(e)})),this.bindLoginLink(),this.bindClearChanges(),this.bindToggleModelView(),this.defaultYearModelValue(),(0,h.Jd)()}async createLoggedInView(){const e=await(async()=>n.Z.getAccountInfo())();this.$el.find(".non-log-in-user-view").addClass("d-none").removeClass("active-view"),this.$el.find(".logged-in-user-view").removeClass("d-none").addClass("active-view"),this.$el.find(".cmp-search-fitment__log-in-section").removeClass("d-none"),e&&e.data?.bikesOwned?.length>0?this.loadSavedBikesDropDown(e.data.bikesOwned):(this.$el.find(".by-saved-filter").addClass("d-none"),this.$el.find(".by-model-filter").removeClass("d-none"),this.$el.find(".model-view-toggle").addClass("d-none"),this.$el.find(".save-bike-to-profile").removeClass("d-none"))}createNonLoggedInView(e){this.$el.find(".non-log-in-user-view").removeClass("d-none").addClass("active-view"),this.$el.find(".logged-in-user-view").addClass("d-none").removeClass("active-view"),this.isGigyaToggle||this.$el.find(".save-bike-to-profile").addClass("d-none"),"EPP"===e?this.$el.find(".cmp-search-fitment__log-in-section").addClass("d-none"):this.$el.find(".cmp-search-fitment__log-in-section").removeClass("d-none")}loadSavedBikesDropDown(e){let t=e;if(t){this.savedBikes=t,$("option:not(:first-of-type)",this.$savedBikesDropdown).remove();for(let e of t){let t=e.name?e.name:e.year+" "+e.model;this.$savedBikesDropdown.append(`<option value="${e.id}" data-uid="${e.id}" data-model-year="${e.year}" data-model-code="${e.model}" data-subtext="${e.year} ${e.model}" data-type="element" data-name="item">${t}</option>`)}return this.$savedBikesDropdown.selectpicker("refresh"),!0}return!1}hide(){this.$el.find(".fitment-template-target").replaceWith('<div class="fitment-template-target"></div>')}render(){$(".authoring-preview",this.$el).remove();const e=$("#cmp-fitment-template",this.$el).html(),t=d().compile(e,(0,h.Xw)());this.$el.find(".fitment-template-target").replaceWith(t.render({})),(0,h.Jd)()}goToUrl(e){this.isLoggedIn=!1,setTimeout((()=>{window.location.href=e}),250)}}$((()=>{$(".cmp-core-fitment").each(((e,t)=>{const i=$(t);try{return new m(i)}catch(e){console.error(e)}})),setTimeout(c,2e3)}))}},function(e){var t;t=30365,e(e.s=t)}]);